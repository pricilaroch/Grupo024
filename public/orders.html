<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Encomendas - Sistema de Gestão de Encomendas</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/orders.css">
</head>
<body>
  <nav id="navbar" class="navbar"></nav>

  <div class="container container-wide">
    <main class="main-content">

      <!-- Page header -->
      <div class="products-header">
        <div>
          <h1 class="products-title">Minhas Encomendas</h1>
          <p class="products-subtitle">Gerencie todas as suas encomendas em um só lugar.</p>
        </div>
        <button id="btnNewOrder" class="btn btn-primary">+ Nova Encomenda</button>
      </div>

      <!-- Filter bar -->
      <div class="products-filter-bar">
        <div class="products-filter-tabs">
          <button class="filter-tab active" data-filter="all">Todas</button>
          <button class="filter-tab" data-filter="pendente">Pendentes</button>
          <button class="filter-tab" data-filter="em_producao">Em Produção</button>
          <button class="filter-tab" data-filter="pronto">Prontos</button>
          <button class="filter-tab" data-filter="entregue">Entregues</button>
          <button class="filter-tab" data-filter="cancelado">Cancelados</button>
        </div>
        <div class="orders-search-row">
          <input type="text" id="searchInput" class="client-search-input" placeholder="Buscar por cliente, nº ou observação…">
          <span id="orderCount" class="products-count"></span>
        </div>
      </div>

      <!-- Orders table -->
      <div id="ordersTableWrap" class="orders-table-wrap" style="display:none;">
        <table class="orders-table" id="ordersTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Cliente</th>
              <th>Entrega</th>
              <th>Status</th>
              <th>Pagamento</th>
              <th class="td-right">Total</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="ordersBody"></tbody>
        </table>
      </div>

      <!-- Empty state -->
      <div id="emptyState" class="products-empty" style="display:none;">
        <div class="products-empty-icon" aria-hidden="true">&#128230;</div>
        <h2>Nenhuma encomenda encontrada</h2>
        <p>Crie sua primeira encomenda e comece a gerenciar sua produção.</p>
        <button id="btnEmptyNew" class="btn btn-primary">+ Criar primeira encomenda</button>
      </div>

      <!-- Empty filter -->
      <div id="emptyFilter" class="products-empty" style="display:none;">
        <div class="products-empty-icon">&#128269;</div>
        <h2>Nenhum resultado</h2>
        <p>Nenhuma encomenda corresponde aos filtros aplicados.</p>
      </div>

      <!-- Loading state -->
      <div id="loadingState" class="admin-loading">Carregando encomendas…</div>

    </main>
  </div>

  <!-- ═══════════════════════════════════════════════════
       Modal: Criar Encomenda (PDV)
       ═══════════════════════════════════════════════════ -->
  <div id="orderModal" class="modal-overlay" style="display:none;">
    <div class="modal modal-order-create">
      <div class="modal-detail-header">
        <h3 id="modalTitle">Nova Encomenda</h3>
        <button id="btnCloseModal" class="btn-icon" aria-label="Fechar">&times;</button>
      </div>

      <div id="modalFeedback" class="pdv-feedback"></div>

      <div class="pdv-modal-grid">
        <!-- LEFT: Dados + Itens -->
        <div class="pdv-modal-left">
          <div class="pdv-section">
            <h4 class="pdv-section-title">Dados do Pedido</h4>
            <div class="header-fields">
              <div>
                <label for="selectClient">Cliente *</label>
                <select id="selectClient"><option value="">Selecione um cliente</option></select>
              </div>
              <div>
                <label for="inputDataEntrega">Data de Entrega</label>
                <input type="datetime-local" id="inputDataEntrega">
              </div>
              <div>
                <label for="selectTipoEntrega">Tipo de Entrega</label>
                <select id="selectTipoEntrega">
                  <option value="retirada">Retirada</option>
                  <option value="entrega">Entrega</option>
                </select>
              </div>
              <div>
                <label for="selectPagamento">Forma de Pagamento</label>
                <select id="selectPagamento">
                  <option value="">Definir depois</option>
                  <option value="pix">PIX</option>
                  <option value="dinheiro">Dinheiro</option>
                  <option value="cartao_credito">Cartão Crédito</option>
                  <option value="cartao_debito">Cartão Débito</option>
                </select>
              </div>
            </div>
            <div style="margin-top:.75rem;">
              <label for="inputObservacoes" style="font-size:.75rem;">Observações</label>
              <textarea id="inputObservacoes" rows="2" placeholder="Observações opcionais…" class="pdv-textarea"></textarea>
            </div>
          </div>

          <div class="pdv-section">
            <h4 class="pdv-section-title">Adicionar Produto</h4>
            <div class="item-adder">
              <div class="form-group" style="flex:2;">
                <label for="selectProduct">Produto</label>
                <select id="selectProduct"><option value="">Selecione um produto</option></select>
              </div>
              <div class="form-group" style="flex:0 0 90px;">
                <label for="inputQtd">Qtd</label>
                <input type="number" id="inputQtd" min="1" value="1" class="pdv-input">
              </div>
              <button id="btnAddItem" class="btn btn-primary btn-sm" style="align-self:end;height:38px;">+ Adicionar</button>
            </div>
          </div>

          <div class="pdv-section">
            <h4 class="pdv-section-title">Itens do Pedido</h4>
            <div id="cartEmpty" class="cart-empty">Nenhum item adicionado.</div>
            <table id="cartTable" class="cart-table" style="display:none;">
              <thead><tr><th>Produto</th><th>Qtd</th><th>Unit.</th><th class="td-right">Subtotal</th><th></th></tr></thead>
              <tbody id="cartBody"></tbody>
            </table>
          </div>
        </div>

        <!-- RIGHT: Resumo Financeiro -->
        <div class="pdv-modal-right">
          <div class="pdv-summary-sticky">
            <h4 class="pdv-section-title">Resumo Financeiro</h4>
            <div class="summary-inputs">
              <div>
                <label for="inputTaxaEntrega">Taxa de Entrega (R$)</label>
                <input type="number" id="inputTaxaEntrega" min="0" step="0.01" value="0" class="pdv-input">
              </div>
              <div>
                <label for="inputDesconto">Desconto (R$)</label>
                <input type="number" id="inputDesconto" min="0" step="0.01" value="0" class="pdv-input">
              </div>
            </div>
            <div class="summary-row"><span class="label">Subtotal</span><span id="sumSubtotal">R$ 0,00</span></div>
            <div class="summary-row"><span class="label">Taxa de Entrega</span><span id="sumTaxa">R$ 0,00</span></div>
            <div class="summary-row"><span class="label">Desconto</span><span id="sumDesconto">- R$ 0,00</span></div>
            <div class="summary-row total"><span class="label">Total</span><span id="sumTotal">R$ 0,00</span></div>
            <div class="summary-row lucro"><span class="label">Lucro Estimado</span><span id="sumLucro">R$ 0,00</span></div>
            <button id="btnSubmitOrder" class="btn btn-primary btn-submit-order" disabled>Confirmar Encomenda</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════════════
       Modal: Editar Encomenda
       ═══════════════════════════════════════════════════ -->
  <div id="editModal" class="modal-overlay" style="display:none;" role="dialog">
    <div class="modal modal-edit">
      <div class="modal-detail-header">
        <h3 id="editTitle">Editar Encomenda</h3>
        <button id="btnCloseEdit" class="btn-icon" aria-label="Fechar">&times;</button>
      </div>
      <form id="editForm" class="edit-form">
        <div class="form-group">
          <label for="editDataEntrega">Data de Entrega</label>
          <input type="date" id="editDataEntrega" class="form-input">
        </div>
        <div class="form-group">
          <label for="editDesconto">Desconto (R$)</label>
          <input type="number" id="editDesconto" class="form-input" min="0" step="0.01">
        </div>
        <div class="form-group">
          <label for="editObservacoes">Observações</label>
          <textarea id="editObservacoes" class="form-input" rows="3"></textarea>
        </div>
        <div id="editFeedback" class="pdv-feedback"></div>
        <div class="modal-actions">
          <button type="button" id="btnCancelEdit" class="btn btn-secondary">Cancelar</button>
          <button type="submit" id="btnSaveEdit" class="btn btn-primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════════════
       Modal: Detalhes da Encomenda
       ═══════════════════════════════════════════════════ -->
  <div id="detailModal" class="modal-overlay" style="display:none;" role="dialog">
    <div class="modal modal-detail">
      <div class="modal-detail-header">
        <h3 id="detailTitle">Detalhes da Encomenda</h3>
        <button id="btnCloseDetail" class="btn-icon" aria-label="Fechar">&times;</button>
      </div>
      <div id="detailContent" class="modal-detail-body"></div>
      <div class="modal-detail-footer">
        <button id="detailBtnEdit" class="btn btn-sm btn-secondary">&#9998; Editar</button>
        <button id="detailBtnClose" class="btn btn-sm btn-secondary">Fechar</button>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════════════
       Modal: Confirmar Exclusão
       ═══════════════════════════════════════════════════ -->
  <div id="deleteModal" class="modal-overlay" style="display:none;">
    <div class="modal">
      <h3>Excluir Encomenda</h3>
      <p class="modal-user-name">Tem certeza que deseja excluir a encomenda <strong id="deleteOrderName"></strong>? Esta ação não pode ser desfeita.</p>
      <div class="modal-actions">
        <button type="button" id="btnCancelDelete" class="btn btn-secondary">Cancelar</button>
        <button type="button" id="btnConfirmDelete" class="btn btn-danger">Excluir</button>
      </div>
    </div>
  </div>

  <script src="/js/services/api.js"></script>
  <script src="/js/services/guard.js"></script>
  <script src="/js/orders.js"></script>
</body>
</html>
